apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
data:
  redis.conf: |
    bind 0.0.0.0
    port 6379

    # Persistence (recommended for BullMQ delayed jobs)
    appendonly yes
    appendfsync everysec

    # Reasonable snapshotting too (optional but helpful)
    save 900 1
    save 300 10
    save 60 10000

    # Avoid surprises
    tcp-keepalive 300
    timeout 0

    # Memory policy: do NOT evict BullMQ keys (better to fail than silently lose delayed jobs)
    maxmemory-policy noeviction